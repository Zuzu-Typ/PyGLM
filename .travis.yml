language: python
os: linux

env:
  global:
      #- CIBW_SKIP=cp34-*
      - CIBW_BUILD=cp37-*
      - CIBW_TEST_COMMAND="python {project}/PyGLM_test.py"
      - CIBW_MANYLINUX_X86_64_IMAGE=manylinux1
      - CIBW_MANYLINUX_I686_IMAGE=manylinux1

jobs:
  include:
    - services: docker # linux
    - os: osx
      language: generic
      env: MACOSX_DEPLOYMENT_TARGET=10.9 # for c++11
      # the tag is incorrect, impending fix at
      # https://github.com/joerick/cibuildwheel/pull/156
    - os: windows
      language: generic
      before_install:
        - choco install python --version 3.8.0
        - export PATH="/c/Python38:/c/Python/Scripts:$PATH"

install:
  - python -m pip install cibuildwheel==1.1.0

script:
  - python -m cibuildwheel --output-dir ./wheelhouse
  - ls wheelhouse

deploy:
  provider: releases
  token:
    secure: "bkMkNwGLlJwuosCOe8TxnOFT3IDBUlzLhBM5mr/loPLmj+KTXE6jGwNGL9FND47l5dZ2cSpPJFDRp52seX4fKvi6KyqwO1D/zQHB+vO/X8zc7bd3pIq23Ga9Ed/8ohDd4LwzmpOIfp4+I43IUSctz0SrD/zFNSGLWYhQ3cq4Eb3OdswHRMMICYlBTCFx8Pr+W1cAiLlV+/z+lCGBl7uYlxO5GSKodGegYX7cAmOP0Jvi60mx5lNqeb9WeMs2+EDHC0CCmQMXIAIArgIUNRcCjMOU1JBU+jMYDkMMtBrqtHVqeBKa1cZ2tI6xvbBXjTeQx+i3Ud64excU7Kp5teuIE2l5AUhhajcSZNRMZiNvDTgwUaeQpnhllNXikyAyokn60mqoX2fUyODJcXFVFs4UclQRuwy5nGoFh6doHzZjv4lcQV28AStrK9uJ14tfIIUX4ckcvM0zK92g+ilpFe1gTlptXqsAjy16IlN9abcrqKrChUWalTNFIHvQSYfxVhrP6TV+wVsEA8A8Eh/WqG91UepWT/qtIvReuT67YMokUo3luOS0qYw0KCFt3SGCW6CT7kG5plxWwPsF4kTyAl8vOxoWzEm2+1hm4ruVdKVsTEKSDEHqLIoDk+gcoNAzLHPf4KHNw1OA+zJYlTmMT28UHDb+3ZyDIROXXJmGP4cj3YE="
  file_glob: true
  file: wheelhouse/*
  cleanup: false
  on:
    tags: true
    all_branches: true
