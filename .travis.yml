language: python
os: linux

env:
  global:
      - CIBW_SKIP=cp34-*
      - CIBW_BUILD=cp3?-*
      - CIBW_TEST_COMMAND="python {project}/PyGLM_test.py"
      - CIBW_MANYLINUX_X86_64_IMAGE=manylinux1
      - CIBW_MANYLINUX_I686_IMAGE=manylinux1

jobs:
  include:
    - services: docker # linux
    - os: osx
      language: generic
      env: MACOSX_DEPLOYMENT_TARGET=10.9 # for c++11
      # the tag is incorrect, impending fix at
      # https://github.com/joerick/cibuildwheel/pull/156
    - os: windows
      language: generic
      before_install:
        - choco install python --version 3.8.0
        - export PATH="/c/Python38:/c/Python/Scripts:$PATH"

install:
  - python -m pip install cibuildwheel==1.1.0

script:
  - python -m cibuildwheel --output-dir ./wheelhouse
  - ls wheelhouse

deploy:
  provider: releases
  token:
    secure: "lB5mLqtnyRD6R4YmAxWmJNGj3xycIWmrwmTGmXrQyFugXoRXSL1+dzMPf7ESHMwwYJxxeDM/PGLCpkFwQKAPpNT/C4zhVe4kQCvJlSmSvDpm9Zdf4PTkEmcjoQrtvsIfO/oOV48alOFJW47RFe8/Y/malg+mrj9Xsp4X+OUkNM/MCuzXPkXl5XvJ9T54HIsuDUiBXoe3c62PNXhoyplzcEEw/DQkW9/lavhOLKj9YhvNoevGhm/rT01qNRjz8rNP4pVvK0YB8Nam5ZZendqts/mEBQIHvUe8V1ilty+gNOBocMm+GrI38BVRIOIMKzbKpSa0V4D7iiCVBbPErM0AiaaBDTz5qs5YqGggsJan5VQ1hOwPiP1NKtSkNn8hqHW5hPjBwy8fWCAn64ndbN/DlfDp9MIhf0TQIWT0ShgXHRRea2bFTO1f7ICbwwjJmIMrSj69tN/XKZlpraRfiApn4ju724jPBu5dgnvwCv6hXXA7VNbbC2bfdzNEjFAsmT9J6/LpNT27h513RGTPujBXwnF7O8hB96zR8kvwUWxNldhUMBtfhinTJzt/9EVYYNZc2qrSxfrMmetdtEgnVToSpG9WNOrSd0LtR8EGk4Taaw+ms/DctmwlarjFdJu47NtIejBQV4YSBRdiPrXBBF9zUQEzeg85vw1jQe3YIZgrlRs="
  file_glob: true
  file: wheelhouse/*
  cleanup: false
  on:
    tags: true
    all_branches: true
